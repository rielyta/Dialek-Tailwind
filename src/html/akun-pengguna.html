<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/style2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <title>Akun Pengguna - Dialek.id</title>
</head>
<body class="bg-custom-radial font-inter flex flex-col min-h-screen">
    <nav class="flex items-center justify-between w-full px-12 py-12">
        <div id="home" class="logo font-irish m-0 text-2xl cursor-pointer">dialek.id</div>
    </nav>

    <section class="main flex flex-col mx-auto max-w-2xl items-center flex-grow space-y-4 -mt-20">
        <div class="flex flex-col justify-center items-center gap-8 pt-8">
            <!-- Profile Section -->
            <div class="flex flex-col md:flex-row items-center justify-center md:items-start w-full max-w-2xl p-6 mt-10 bg-white bg-opacity-30 rounded-3xl shadow-lg font-inter border-[1.5px] border-bar">
                <!-- Profile Image -->
                <img id="profile-image" src="../assets/pp.webp" alt="Profile Image" class="w-24 h-24 rounded-full bg-gray-200 -mt-5 md:mt-0 md:mr-6">
            
                <!-- Content Section -->
                <div class="flex flex-col w-full">
                    <!-- Name and Setting Button -->
                    <div class="flex items-center justify-between w-full">
                        <div class="text-center md:text-left">
                            <p id="profile-name" class="text-xl font-semibold text-custom2">Memuat...</p>
                            <p id="profile-username" class="text-gray-500">memuat...</p>
                        </div>
                        <button id="SettingButton" class="text-custom2">
                            <i class="fa-solid fa-gear text-3xl"></i>
                        </button>
                    </div>
            
                    <!-- Stats Section -->
                    <ul class="flex flex-wrap justify-center md:justify-start space-x-4 mt-4 text-xs">
                        <li id="total-exp" class="text-white bg-custom1 rounded-xl w-32 h-12 text-left pl-2 pt-1">
                            <span class="font-semibold">Total Exp</span><br>
                            <span id="exp-value">0</span>
                        </li>
                        <li id="level" class="text-white bg-custom1 rounded-xl w-32 h-12 text-left pl-2 pt-1">
                            <span class="font-semibold">Level</span><br>
                            <span id="level-value">0</span>
                        </li>
                        <li id="study-duration" class="text-white bg-custom1 rounded-xl w-32 h-12 text-left pl-2 pt-1">
                            <span class="font-semibold">Durasi Belajar</span><br>
                            <span id="duration-value">0 Menit</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- BAHASA YG DIPELAJARI -->
            <div class="w-full max-w-2xl p-6 bg-white bg-opacity-30 rounded-3xl shadow-lg font-inter border-[1.5px] border-bar"> 
                <p class="text-lg font-semibold mb-2 text-custom2">Bahasa yang Dipelajari</p>
                <div id="language" class="bg-custom1 text-white rounded-full px-4 py-2 max-w-44">
                    <h3>Bahasa Batak Toba</h3>
                </div>
            </div>

            <!-- Logout Button -->
            <div class="w-full max-w-2xl p-6 bg-white bg-opacity-30 rounded-3xl shadow-lg font-inter border-[1.5px] border-bar">
                <button id="logout-button" class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">
                    Keluar
                </button>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCrmVDlBwRkkzP_rYY3mXBKw_ihrkV3tVM",
            authDomain: "dialek-6a219.firebaseapp.com",
            databaseURL: "https://dialek-6a219-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dialek-6a219",
            storageBucket: "dialek-6a219.firebasestorage.app",
            messagingSenderId: "423916223695",
            appId: "1:423916223695:web:449bd44c54cad998d8cbba",
            measurementId: "G-4SLBH47WTM"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check authentication and load user data
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        
                        // Update profile display
                        document.getElementById('profile-name').textContent = userData.name || 'Nama Tidak Ditemukan';
                        document.getElementById('profile-username').textContent = `@${userData.username || 'username'}`;
                        document.getElementById('profile-image').src = userData.profile_image || '../assets/pp.webp';
                        
                        // Update stats
                        document.getElementById('exp-value').textContent = userData.total_exp || 0;
                        document.getElementById('level-value').textContent = userData.level || 0;
                        document.getElementById('duration-value').textContent = `${userData.study_duration || 0} Menit`;
                    } else {
                        alert("Data pengguna tidak ditemukan");
                        window.location.href = "../../masuk.html";
                    }
                } catch (error) {
                    console.error("Error loading user data:", error);
                    alert("Terjadi kesalahan saat memuat data pengguna");
                }
            } else {
                alert("Silakan login terlebih dahulu");
                window.location.href = "./masuk.html";
            }
        });

        // Navigation handlers
        document.getElementById("home").addEventListener("click", () => {
            window.location.href = "./dashboardBatak.html";
        });

        document.getElementById("SettingButton").addEventListener("click", () => {
            window.location.href = "./Pengaturan.html";
        });

        // Logout handler
        document.getElementById("logout-button").addEventListener("click", async () => {
            try {
                await signOut(auth);
                localStorage.clear();
                alert("Logout berhasil!");
                window.location.href = "./masuk.html";
            } catch (error) {
                console.error("Logout Error:", error);
                alert("Terjadi kesalahan saat logout");
            }
        });
    </script>
</body>
</html>